"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var list_seeder_1 = require("./utils/testing/list_seeder");
var api_1 = require("./models/api");
var seedLine = [
    function (app) {
        app.globalData.lists = (new list_seeder_1.ListSeeder).seedManyTimes(20);
    }
];
App({
    onLaunch: function () {
        var _this = this;
        this.globalData.api = api_1.getApiFacade(api_1.ApiEnvironment.PROD);
        var logs = wx.getStorageSync('logs') || [];
        logs.unshift(Date.now());
        wx.setStorageSync('logs', logs);
        var loginCode;
        wx.login({
            success: function (_res) {
                loginCode = _res.code;
            }
        });
        wx.getSetting({
            success: function (res) {
                if (res.authSetting['scope.userInfo']) {
                    wx.getUserInfo({
                        success: function (res) {
                            _this.globalData.userInfo = res.userInfo;
                            if (_this.userInfoReadyCallback) {
                                _this.userInfoReadyCallback(res.userInfo);
                            }
                            if (loginCode) {
                                _this.globalData.api && _this.globalData.api.login(loginCode, res.userInfo).then(function () {
                                    return _this.globalData.api && _this.globalData.api.getGroups().then(function (lists) {
                                        _this.globalData.lists = lists;
                                    }).then(_this.globalData.listUpdateCallback);
                                });
                                console.log("Logining");
                            }
                        }
                    });
                }
            }
        });
    },
    getListById: function (id) {
        for (var i in this.globalData.lists) {
            if (this.globalData.lists[i].group_id == id) {
                return this.globalData.lists[i];
            }
        }
        throw new Error("不存在该清单ID");
    },
    putList: function (list) {
        for (var i in this.globalData.lists) {
            if (this.globalData.lists[i].group_id == list.group_id) {
                this.globalData.lists[i] = list;
                return;
            }
        }
        this.globalData.lists.push(list);
    },
    deleteListById: function (id) {
        for (var i in this.globalData.lists) {
            if (this.globalData.lists[i].group_id == id) {
                this.globalData.lists.splice(+i, 1);
                return;
            }
        }
    },
    refreshLists: function () {
        var _this = this;
        this.globalData.api && this.globalData.api.getGroups()
            .then(function (r) {
            _this.globalData.lists = r;
        })
            .then(this.globalData.listUpdateCallback);
    },
    globalData: {
        lists: [],
        last_list_id: 21
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEsMkRBQXdEO0FBQ3hELG9DQUF1RTtBQWlCdkUsSUFBSSxRQUFRLEdBQWlDO0lBRTNDLFVBQUMsR0FBRztRQUNGLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxHQUFHLENBQUMsSUFBSSx3QkFBVSxDQUFDLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0lBQzNELENBQUM7Q0FDRixDQUFBO0FBRUQsR0FBRyxDQUFTO0lBQ1YsUUFBUSxFQUFSO1FBQUEsaUJBbURDO1FBbERDLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxHQUFHLGtCQUFZLENBQUMsb0JBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQU12RCxJQUFJLElBQUksR0FBYSxFQUFFLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQTtRQUNwRCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFBO1FBQ3hCLEVBQUUsQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFBO1FBRy9CLElBQUksU0FBaUIsQ0FBQztRQUN0QixFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ1AsT0FBTyxZQUFDLElBQUk7Z0JBR1YsU0FBUyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7WUFDdkIsQ0FBQztTQUNGLENBQUMsQ0FBQTtRQUVGLEVBQUUsQ0FBQyxVQUFVLENBQUM7WUFDWixPQUFPLEVBQUUsVUFBQyxHQUFHO2dCQUNYLElBQUksR0FBRyxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFO29CQUVyQyxFQUFFLENBQUMsV0FBVyxDQUFDO3dCQUNiLE9BQU8sRUFBRSxVQUFBLEdBQUc7NEJBRVYsS0FBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQTs0QkFHdkMsSUFBSSxL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cC50c1xuaW1wb3J0IHsgSUxpc3QgfSBmcm9tICcuL3V0aWxzL3R5cGVzJ1xuaW1wb3J0IHsgTGlzdFNlZWRlciB9IGZyb20gJy4vdXRpbHMvdGVzdGluZy9saXN0X3NlZWRlcidcbmltcG9ydCB7IGdldEFwaUZhY2FkZSwgSUFwaUZhY2FkZSwgQXBpRW52aXJvbm1lbnQgfSBmcm9tICcuL21vZGVscy9hcGknXG5cbmV4cG9ydCBpbnRlcmZhY2UgSU15QXBwIHtcbiAgZ2V0TGlzdEJ5SWQoaWQ6IG51bWJlcik6IElMaXN0LFxuICBwdXRMaXN0KGxpc3Q6IElMaXN0KTogdm9pZCxcbiAgZGVsZXRlTGlzdEJ5SWQoaWQ6IG51bWJlcik6IHZvaWQsXG4gIHVzZXJJbmZvUmVhZHlDYWxsYmFjaz8ocmVzOiB3eC5Vc2VySW5mbyk6IHZvaWRcbiAgcmVmcmVzaExpc3RzKCk6IHZvaWRcbiAgZ2xvYmFsRGF0YToge1xuICAgIGFwaT86IElBcGlGYWNhZGVcbiAgICB1c2VySW5mbz86IHd4LlVzZXJJbmZvXG4gICAgbGlzdHM6IEFycmF5PElMaXN0PlxuICAgIGxhc3RfbGlzdF9pZDogbnVtYmVyXG4gICAgbGlzdFVwZGF0ZUNhbGxiYWNrPzogKCkgPT4gdm9pZFxuICB9XG59XG5cbnZhciBzZWVkTGluZTogQXJyYXk8KGFwcDogSU15QXBwKSA9PiB2b2lkPiA9IFtcbiAgLy8gU2VlZCBMaXN0c1xuICAoYXBwKSA9PiB7XG4gICAgYXBwLmdsb2JhbERhdGEubGlzdHMgPSAobmV3IExpc3RTZWVkZXIpLnNlZWRNYW55VGltZXMoMjApXG4gIH1cbl1cblxuQXBwPElNeUFwcD4oe1xuICBvbkxhdW5jaCgpIHtcbiAgICB0aGlzLmdsb2JhbERhdGEuYXBpID0gZ2V0QXBpRmFjYWRlKEFwaUVudmlyb25tZW50LlBST0QpXG4gICAgLy8gU2VlZCBFdmVyeXRoaW5nOiBObyBuZWVkIHRvIHNlZWRcbiAgICAvKmZvciAodmFyIGkgaW4gc2VlZExpbmUpIHtcbiAgICAgIHNlZWRMaW5lW2ldKHRoaXMpXG4gICAgfSovXG4gICAgLy8g5bGV56S65pys5Zyw5a2Y5YKo6IO95YqbXG4gICAgdmFyIGxvZ3M6IG51bWJlcltdID0gd3guZ2V0U3RvcmFnZVN5bmMoJ2xvZ3MnKSB8fCBbXVxuICAgIGxvZ3MudW5zaGlmdChEYXRlLm5vdygpKVxuICAgIHd4LnNldFN0b3JhZ2VTeW5jKCdsb2dzJywgbG9ncylcblxuICAgIC8vIOeZu+W9lVxuICAgIHZhciBsb2dpbkNvZGU6IHN0cmluZztcbiAgICB3eC5sb2dpbih7XG4gICAgICBzdWNjZXNzKF9yZXMpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coX3Jlcy5jb2RlKVxuICAgICAgICAvLyDlj5HpgIEgX3Jlcy5jb2RlIOWIsOWQjuWPsOaNouWPliBvcGVuSWQsIHNlc3Npb25LZXksIHVuaW9uSWRcbiAgICAgICAgbG9naW5Db2RlID0gX3Jlcy5jb2RlXG4gICAgICB9XG4gICAgfSlcbiAgICAvLyDojrflj5bnlKjmiLfkv6Hmga9cbiAgICB3eC5nZXRTZXR0aW5nKHtcbiAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgaWYgKHJlcy5hdXRoU2V0dGluZ1snc2NvcGUudXNlckluZm8nXSkge1xuICAgICAgICAgIC8vIOW3sue7j+aOiOadg++8jOWPr+S7peebtOaOpeiwg+eUqCBnZXRVc2VySW5mbyDojrflj5blpLTlg4/mmLXnp7DvvIzkuI3kvJrlvLnmoYZcbiAgICAgICAgICB3eC5nZXRVc2VySW5mbyh7XG4gICAgICAgICAgICBzdWNjZXNzOiByZXMgPT4ge1xuICAgICAgICAgICAgICAvLyDlj6/ku6XlsIYgcmVzIOWPkemAgee7meWQjuWPsOino+eggeWHuiB1bmlvbklkXG4gICAgICAgICAgICAgIHRoaXMuZ2xvYmFsRGF0YS51c2VySW5mbyA9IHJlcy51c2VySW5mb1xuICAgICAgICAgICAgICAvLyDnlLHkuo4gZ2V0VXNlckluZm8g5piv572R57uc6K+35rGC77yM5Y+v6IO95Lya5ZyoIFBhZ2Uub25Mb2FkIOS5i+WQjuaJjei/lOWbnlxuICAgICAgICAgICAgICAvLyDmiYDku6XmraTlpITliqDlhaUgY2FsbGJhY2sg5Lul6Ziy5q2i6L+Z56eN5oOF5Ya1XG4gICAgICAgICAgICAgIGlmICh0aGlzLnVzZXJJbmZvUmVhZHlDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHRoaXMudXNlckluZm9SZWFkeUNhbGxiYWNrKHJlcy51c2VySW5mbylcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAobG9naW5Db2RlKSB7XG4gICAgICAgICAgICAgICAgLy8gTG9naW4hXG4gICAgICAgICAgICAgICAgdGhpcy5nbG9iYWxEYXRhLmFwaSAmJiB0aGlzLmdsb2JhbERhdGEuYXBpLmxvZ2luKGxvZ2luQ29kZSwgcmVzLnVzZXJJbmZvKS50aGVuKFxuICAgICAgICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBHZXQgR3JvdXBzIVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nbG9iYWxEYXRhLmFwaSAmJiB0aGlzLmdsb2JhbERhdGEuYXBpLmdldEdyb3VwcygpLnRoZW4oKGxpc3RzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5nbG9iYWxEYXRhLmxpc3RzID0gbGlzdHNcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbih0aGlzLmdsb2JhbERhdGEubGlzdFVwZGF0ZUNhbGxiYWNrKVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkxvZ2luaW5nXCIpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSxcbiAgZ2V0TGlzdEJ5SWQoaWQ6IG51bWJlcik6IElMaXN0IHtcbiAgICBmb3IgKHZhciBpIGluIHRoaXMuZ2xvYmFsRGF0YS5saXN0cykge1xuICAgICAgaWYgKHRoaXMuZ2xvYmFsRGF0YS5saXN0c1tpXS5ncm91cF9pZCA9PSBpZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nbG9iYWxEYXRhLmxpc3RzW2ldXG4gICAgICB9XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihcIuS4jeWtmOWcqOivpea4heWNlUlEXCIpXG4gIH0sXG4gIHB1dExpc3QobGlzdDogSUxpc3QpIHtcbiAgICBmb3IgKHZhciBpIGluIHRoaXMuZ2xvYmFsRGF0YS5saXN0cykge1xuICAgICAgaWYgKHRoaXMuZ2xvYmFsRGF0YS5saXN0c1tpXS5ncm91cF9pZCA9PSBsaXN0Lmdyb3VwX2lkKSB7XG4gICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5saXN0c1tpXSA9IGxpc3RcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuZ2xvYmFsRGF0YS5saXN0cy5wdXNoKGxpc3QpXG4gIH0sXG4gIGRlbGV0ZUxpc3RCeUlkKGlkOiBudW1iZXIpOiB2b2lkIHtcbiAgICBmb3IgKHZhciBpIGluIHRoaXMuZ2xvYmFsRGF0YS5saXN0cykge1xuICAgICAgaWYgKHRoaXMuZ2xvYmFsRGF0YS5saXN0c1tpXS5ncm91cF9pZCA9PSBpZCkge1xuICAgICAgICB0aGlzLmdsb2JhbERhdGEubGlzdHMuc3BsaWNlKCtpLCAxKVxuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHJlZnJlc2hMaXN0cygpOiB2b2lkIHtcbiAgICB0aGlzLmdsb2JhbERhdGEuYXBpICYmIHRoaXMuZ2xvYmFsRGF0YS5hcGkuZ2V0R3JvdXBzKClcbiAgICAgIC50aGVuKChyKSA9PiB7XG4gICAgICAgIHRoaXMuZ2xvYmFsRGF0YS5saXN0cyA9IHJcbiAgICAgIH0pXG4gICAgICAudGhlbih0aGlzLmdsb2JhbERhdGEubGlzdFVwZGF0ZUNhbGxiYWNrKVxuICB9LFxuICBnbG9iYWxEYXRhOiB7XG4gICAgbGlzdHM6IFtdLFxuICAgIGxhc3RfbGlzdF9pZDogMjFcbiAgfVxufSkiXX0=