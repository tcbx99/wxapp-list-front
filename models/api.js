"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var APP_BASE = "https://list2-wxapp.tcbx99.cn/";
var ApiFacade = (function () {
    function ApiFacade() {
        this.token = '';
        this.user_id = 0;
        this.dummy_group_id = 1;
    }
    ApiFacade.prototype.promisify = function (f, p) {
        return new Promise(function (r, e) {
            p.success = function (d) { r(d); };
            p.fail = function (d) { e(d); };
            f(p);
        });
    };
    ApiFacade.prototype.login = function (code, u) {
        var _this = this;
        console.log("What");
        return this.promisify(wx.request, {
            url: APP_BASE + 'login',
            method: 'POST',
            data: {
                auth_code: code,
                nickname: u.nickName,
                avatar_url: u.avatarUrl,
            }
        }).then(function (r) {
            _this.token = r.data.token;
            _this.user_id = +r.data.user_id;
            return {
                token: r.data.token,
                user_id: r.data.user_id
            };
        });
    };
    ApiFacade.prototype.createGroup = function (name, desc, gType) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'createGroup' + '?user_id=' + this.user_id,
            method: 'POST',
            data: {
                group_name: name,
                group_desc: desc,
                group_type: gType,
            }
        }).then(function (r) {
            return r.data;
        });
    };
    ApiFacade.prototype.updateGroup = function (list) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'updateGroup' + '?user_id=' + this.user_id,
            method: 'POST',
            data: {
                group_name: list.group_name,
                group_desc: list.group_desc,
                group_type: list.group_type,
            }
        }).then(function (r) {
            return r.data;
        });
    };
    ApiFacade.prototype.deleteGroup = function () { return new Promise(function (r) { r(); }); };
    ApiFacade.prototype.joinGroupFlow = function (id) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'joinGroupFlow' + '?user_id=' + this.user_id,
            method: 'POST',
            data: {
                group_id: id
            }
        }).then(function (r) {
            return r.data;
        });
    };
    ApiFacade.prototype.joinGroupConfirm = function (id) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'joinGroupConfirm' + '?user_id=' + this.user_id,
            method: 'POST',
            data: {
                group_id: id
            }
        }).then(function (r) {
            return r.data;
        });
    };
    ApiFacade.prototype.getGroups = function () {
        return this.promisify(wx.request, {
            url: APP_BASE + 'getGroups' + '?user_id=' + this.user_id,
            method: 'GET',
        }).then(function (r) {
            return r.data;
        });
    };
    ApiFacade.prototype.createMission = function (mission) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'createMission' + '?user_id=' + this.user_id,
            method: 'POST',
            data: mission
        }).then(function (r) {
            return r.data;
        });
    };
    ApiFacade.prototype.completeMission = function (mission) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'completeMission' + '?user_id=' + this.user_id,
            method: 'POST',
            data: mission.mission_id
        });
    };
    ApiFacade.prototype.rejectMission = function (mission) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'rejectMission' + '?user_id=' + this.user_id,
            method: 'POST',
            data: mission.mission_id
        });
    };
    ApiFacade.prototype.deleteAllDone = function (group) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'clearMissions' + '?user_id=' + this.user_id,
            method: 'POST',
            data: group.group_id
        });
    };
    ApiFacade.prototype.getMissions = function (group_id, is_admin) {
        if (is_admin) {
            return this.promisify(wx.request, {
                url: APP_BASE + 'getMissionsForGroup' + '?user_id=' + this.user_id,
                method: 'POST',
                data: group_id
            }).then(function (r) { return r.data; });
        }
        else {
            return this.promisify(wx.request, {
                url: APP_BASE + 'getMissionsForUser' + '?user_id=' + this.user_id,
                method: 'POST',
                data: group_id
            }).then(function (r) { return r.data; });
        }
    };
    ApiFacade.prototype.getMembersByGroup = function (id) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'getMemberByGroup' + '?user_id=' + this.user_id,
            method: 'POST',
            data: id
        }).then(function (r) {
            return r.data;
        });
    };
    return ApiFacade;
}());
function getApiFacade() {
    return new ApiFacade();
}
exports.getApiFacade = getApiFacade;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBpLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBdUJBLElBQU0sUUFBUSxHQUFHLGdDQUFnQyxDQUFBO0FBRWpEO0lBQUE7UUFDRSxVQUFLLEdBQUcsRUFBRSxDQUFBO1FBQ1YsWUFBTyxHQUFHLENBQUMsQ0FBQTtRQUNYLG1CQUFjLEdBQVcsQ0FBQyxDQUFBO0lBNEk1QixDQUFDO0lBMUlTLDZCQUFTLEdBQWpCLFVBQWtCLENBQWtCLEVBQUUsQ0FBTTtRQUMxQyxPQUFPLElBQUksT0FBTyxDQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUM7WUFDdEIsQ0FBQyxDQUFDLE9BQU8sR0FBRyxVQUFDLENBQU0sSUFBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUE7WUFDaEMsQ0FBQyxDQUFDLElBQUksR0FBRyxVQUFDLENBQU0sSUFBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUE7WUFDN0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ04sQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQseUJBQUssR0FBTCxVQUFNLElBQVksRUFBRSxDQUFjO1FBQWxDLGlCQWtCQztRQWpCQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ25CLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFO1lBQ2hDLEdBQUcsRUFBRSxRQUFRLEdBQUcsT0FBTztZQUN2QixNQUFNLEVBQUUsTUFBTTtZQUNkLElBQUksRUFBRTtnQkFDSixTQUFTLEVBQUUsSUFBSTtnQkFDZixRQUFRLEVBQUUsQ0FBQyxDQUFDLFFBQVE7Z0JBQ3BCLFVBQVUsRUFBRSxDQUFDLENBQUMsU0FBUzthQUN4QjtTQUNGLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxDQUFNO1lBQ2IsS0FBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMs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QUNiLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQTtRQUNmLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUNILGdCQUFDO0FBQUQsQ0FBQyxBQS9JRCxJQStJQztBQUdELFNBQWdCLFlBQVk7SUFDMUIsT0FBTyxJQUFJLFNBQVMsRUFBRSxDQUFDO0FBQ3pCLENBQUM7QUFGRCxvQ0FFQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElMaXN0LCBJTWlzc2lvbiB9IGZyb20gJy4uL3V0aWxzL3R5cGVzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIElBcGlGYWNhZGUge1xuICBsb2dpbihjb2RlOiBzdHJpbmcsIHU6IHd4LlVzZXJJbmZvKTogUHJvbWlzZTxMb2dpblJlc3BvbnNlPlxuICBjcmVhdGVHcm91cChuYW1lOiBzdHJpbmcsIGRlc2M6IHN0cmluZywgZ1R5cGU6IG51bWJlcik6IFByb21pc2U8SUxpc3Q+XG4gIHVwZGF0ZUdyb3VwKGxpc3Q6IElMaXN0KTogUHJvbWlzZTxJTGlzdD5cbiAgZGVsZXRlR3JvdXAobGlzdDogSUxpc3QpOiBQcm9taXNlPHZvaWQ+XG4gIGpvaW5Hcm91cEZsb3coaWQ6IG51bWJlcik6IFByb21pc2U8eyBncm91cF9uYW1lOiBzdHJpbmcsIGdyb3VwX2Rlc2M6IHN0cmluZyB9PlxuICBqb2luR3JvdXBDb25maXJtKGlkOiBudW1iZXIpOiBQcm9taXNlPElMaXN0PlxuICBnZXRHcm91cHMoKTogUHJvbWlzZTxBcnJheTxJTGlzdD4+XG4gIGdldE1lbWJlcnNCeUdyb3VwKGlkOiBudW1iZXIpOiBQcm9taXNlPEFycmF5PHsgbWVtYmVyX2lkOiBudW1iZXIsIG5pY2tuYW1lOiBzdHJpbmcgfT4+XG4gIGNyZWF0ZU1pc3Npb24obWlzc2lvbjogSU1pc3Npb24pOiBQcm9taXNlPElNaXNzaW9uPlxuICBjb21wbGV0ZU1pc3Npb24obWlzc2lvbjogSU1pc3Npb24pOiBQcm9taXNlPGFueT5cbiAgcmVqZWN0TWlzc2lvbihtaXNzaW9uOiBJTWlzc2lvbik6IFByb21pc2U8YW55PlxuICBkZWxldGVBbGxEb25lKGdyb3VwOiBJTGlzdCk6IFByb21pc2U8YW55PlxuICBnZXRNaXNzaW9ucyhncm91cF9pZDogbnVtYmVyLCBpc19hZG1pbjogYm9vbGVhbik6IFByb21pc2U8QXJyYXk8SU1pc3Npb24+PlxufVxuXG5pbnRlcmZhY2UgTG9naW5SZXNwb25zZSB7XG4gIHRva2VuOiBzdHJpbmcsXG4gIHVzZXJfaWQ6IG51bWJlclxufVxuXG5jb25zdCBBUFBfQkFTRSA9IFwiaHR0cHM6Ly9saXN0Mi13eGFwcC50Y2J4OTkuY24vXCJcblxuY2xhc3MgQXBpRmFjYWRlIGltcGxlbWVudHMgSUFwaUZhY2FkZSB7XG4gIHRva2VuID0gJydcbiAgdXNlcl9pZCA9IDBcbiAgZHVtbXlfZ3JvdXBfaWQ6IG51bWJlciA9IDFcblxuICBwcml2YXRlIHByb21pc2lmeShmOiAobzogYW55KSA9PiBhbnksIHA6IGFueSk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyLCBlKSA9PiB7XG4gICAgICBwLnN1Y2Nlc3MgPSAoZDogYW55KSA9PiB7IHIoZCkgfVxuICAgICAgcC5mYWlsID0gKGQ6IGFueSkgPT4geyBlKGQpIH1cbiAgICAgIGYocClcbiAgICB9KVxuICB9XG5cbiAgbG9naW4oY29kZTogc3RyaW5nLCB1OiB3eC5Vc2VySW5mbyk6IFByb21pc2U8TG9naW5SZXNwb25zZT4ge1xuICAgIGNvbnNvbGUubG9nKFwiV2hhdFwiKVxuICAgIHJldHVybiB0aGlzLnByb21pc2lmeSh3eC5yZXF1ZXN0LCB7XG4gICAgICB1cmw6IEFQUF9CQVNFICsgJ2xvZ2luJyxcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgZGF0YToge1xuICAgICAgICBhdXRoX2NvZGU6IGNvZGUsXG4gICAgICAgIG5pY2tuYW1lOiB1Lm5pY2tOYW1lLFxuICAgICAgICBhdmF0YXJfdXJsOiB1LmF2YXRhclVybCxcbiAgICAgIH1cbiAgICB9KS50aGVuKChyOiBhbnkpID0+IHtcbiAgICAgIHRoaXMudG9rZW4gPSByLmRhdGEudG9rZW5cbiAgICAgIHRoaXMudXNlcl9pZCA9ICtyLmRhdGEudXNlcl9pZFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdG9rZW46IHIuZGF0YS50b2tlbixcbiAgICAgICAgdXNlcl9pZDogci5kYXRhLnVzZXJfaWRcbiAgICAgIH1cbiAgICB9KVxuICB9XG4gIGNyZWF0ZUdyb3VwKG5hbWU6IHN0cmluZywgZGVzYzogc3RyaW5nLCBnVHlwZTogbnVtYmVyKTogUHJvbWlzZTxJTGlzdD4ge1xuICAgIHJldHVybiB0aGlzLnByb21pc2lmeSh3eC5yZXF1ZXN0LCB7XG4gICAgICB1cmw6IEFQUF9CQVNFICsgJ2NyZWF0ZUdyb3VwJyArICc/dXNlcl9pZD0nICsgdGhpcy51c2VyX2lkLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGdyb3VwX25hbWU6IG5hbWUsXG4gICAgICAgIGdyb3VwX2Rlc2M6IGRlc2MsXG4gICAgICAgIGdyb3VwX3R5cGU6IGdUeXBlLFxuICAgICAgfVxuICAgIH0pLnRoZW4oKHI6IGFueSkgPT4ge1xuICAgICAgcmV0dXJuIDxJTGlzdD48YW55PnIuZGF0YTtcbiAgICB9KVxuICB9XG4gIHVwZGF0ZUdyb3VwKGxpc3Q6IElMaXN0KTogUHJvbWlzZTxJTGlzdD4ge1xuICAgIHJldHVybiB0aGlzLnByb21pc2lmeSh3eC5yZXF1ZXN0LCB7XG4gICAgICB1cmw6IEFQUF9CQVNFICsgJ3VwZGF0ZUdyb3VwJyArICc/dXNlcl9pZD0nICsgdGhpcy51c2VyX2lkLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGdyb3VwX25hbWU6IGxpc3QuZ3JvdXBfbmFtZSxcbiAgICAgICAgZ3JvdXBfZGVzYzogbGlzdC5ncm91cF9kZXNjLFxuICAgICAgICBncm91cF90eXBlOiBsaXN0Lmdyb3VwX3R5cGUsXG4gICAgICB9XG4gICAgfSkudGhlbigocjogYW55KSA9PiB7XG4gICAgICByZXR1cm4gPElMaXN0Pjxhbnk+ci5kYXRhO1xuICAgIH0pXG4gIH1cbiAgZGVsZXRlR3JvdXAoKTogUHJvbWlzZTx2b2lkPiB7IHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocikgPT4geyByKCkgfSkgfVxuICBqb2luR3JvdXBGbG93KGlkOiBudW1iZXIpOiBQcm9taXNlPHsgZ3JvdXBfbmFtZTogc3RyaW5nLCBncm91cF9kZXNjOiBzdHJpbmcgfT4ge1xuICAgIHJldHVybiB0aGlzLnByb21pc2lmeSh3eC5yZXF1ZXN0LCB7XG4gICAgICB1cmw6IEFQUF9CQVNFICsgJ2pvaW5Hcm91cEZsb3cnICsgJz91c2VyX2lkPScgKyB0aGlzLnVzZXJfaWQsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgZ3JvdXBfaWQ6IGlkXG4gICAgICB9XG4gICAgfSkudGhlbigocjogYW55KSA9PiB7XG4gICAgICByZXR1cm4gPGFueT5yLmRhdGE7XG4gICAgfSlcbiAgfVxuICBqb2luR3JvdXBDb25maXJtKGlkOiBudW1iZXIpOiBQcm9taXNlPElMaXN0PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvbWlzaWZ5KHd4LnJlcXVlc3QsIHtcbiAgICAgIHVybDogQVBQX0JBU0UgKyAnam9pbkdyb3VwQ29uZmlybScgKyAnP3VzZXJfaWQ9JyArIHRoaXMudXNlcl9pZCxcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgZGF0YToge1xuICAgICAgICBncm91cF9pZDogaWRcbiAgICAgIH1cbiAgICB9KS50aGVuKChyOiBhbnkpID0+IHtcbiAgICAgIHJldHVybiA8YW55PnIuZGF0YTtcbiAgICB9KVxuICB9XG4gIGdldEdyb3VwcygpOiBQcm9taXNlPEFycmF5PElMaXN0Pj4ge1xuICAgIHJldHVybiB0aGlzLnByb21pc2lmeSh3eC5yZXF1ZXN0LCB7XG4gICAgICB1cmw6IEFQUF9CQVNFICsgJ2dldEdyb3VwcycgKyAnP3VzZXJfaWQ9JyArIHRoaXMudXNlcl9pZCxcbiAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgfSkudGhlbigocjogYW55KSA9PiB7XG4gICAgICByZXR1cm4gPGFueT5yLmRhdGE7XG4gICAgfSlcbiAgfVxuICBjcmVhdGVNaXNzaW9uKG1pc3Npb246IElNaXNzaW9uKTogUHJvbWlzZTxJTWlzc2lvbj4ge1xuICAgIHJldHVybiB0aGlzLnByb21pc2lmeSh3eC5yZXF1ZXN0LCB7XG4gICAgICB1cmw6IEFQUF9CQVNFICsgJ2NyZWF0ZU1pc3Npb24nICsgJz91c2VyX2lkPScgKyB0aGlzLnVzZXJfaWQsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGRhdGE6IG1pc3Npb25cbiAgICB9KS50aGVuKChyOiBhbnkpID0+IHtcbiAgICAgIHJldHVybiA8YW55PnIuZGF0YTtcbiAgICB9KVxuICB9XG4gIGNvbXBsZXRlTWlzc2lvbihtaXNzaW9uOiBJTWlzc2lvbik6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvbWlzaWZ5KHd4LnJlcXVlc3QsIHtcbiAgICAgIHVybDogQVBQX0JBU0UgKyAnY29tcGxldGVNaXNzaW9uJyArICc/dXNlcl9pZD0nICsgdGhpcy51c2VyX2lkLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBkYXRhOiBtaXNzaW9uLm1pc3Npb25faWRcbiAgICB9KVxuICB9XG4gIHJlamVjdE1pc3Npb24obWlzc2lvbjogSU1pc3Npb24pOiBQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLnByb21pc2lmeSh3eC5yZXF1ZXN0LCB7XG4gICAgICB1cmw6IEFQUF9CQVNFICsgJ3JlamVjdE1pc3Npb24nICsgJz91c2VyX2lkPScgKyB0aGlzLnVzZXJfaWQsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGRhdGE6IG1pc3Npb24ubWlzc2lvbl9pZFxuICAgIH0pXG4gIH1cbiAgZGVsZXRlQWxsRG9uZShncm91cDogSUxpc3QpOiBQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLnByb21pc2lmeSh3eC5yZXF1ZXN0LCB7XG4gICAgICB1cmw6IEFQUF9CQVNFICsgJ2NsZWFyTWlzc2lvbnMnICsgJz91c2VyX2lkPScgKyB0aGlzLnVzZXJfaWQsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGRhdGE6IGdyb3VwLmdyb3VwX2lkXG4gICAgfSlcbiAgfVxuICBnZXRNaXNzaW9ucyhncm91cF9pZDogbnVtYmVyLCBpc19hZG1pbjogYm9vbGVhbik6IFByb21pc2U8QXJyYXk8SU1pc3Npb24+PiB7XG4gICAgaWYgKGlzX2FkbWluKSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9taXNpZnkod3gucmVxdWVzdCwge1xuICAgICAgICB1cmw6IEFQUF9CQVNFICsgJ2dldE1pc3Npb25zRm9yR3JvdXAnICsgJz91c2VyX2lkPScgKyB0aGlzLnVzZXJfaWQsXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBkYXRhOiBncm91cF9pZFxuICAgICAgfSkudGhlbihyPT5yLmRhdGEpXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLnByb21pc2lmeSh3eC5yZXF1ZXN0LCB7XG4gICAgICAgIHVybDogQVBQX0JBU0UgKyAnZ2V0TWlzc2lvbnNGb3JVc2VyJyArICc/dXNlcl9pZD0nICsgdGhpcy51c2VyX2lkLFxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgZGF0YTogZ3JvdXBfaWRcbiAgICAgIH0pLnRoZW4ociA9PiByLmRhdGEpXG4gICAgfVxuICB9XG4gIGdldE1lbWJlcnNCeUdyb3VwKGlkOiBudW1iZXIpOiBQcm9taXNlPEFycmF5PHsgbWVtYmVyX2lkOiBudW1iZXIsIG5pY2tuYW1lOiBzdHJpbmcgfT4+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9taXNpZnkod3gucmVxdWVzdCwge1xuICAgICAgdXJsOiBBUFBfQkFTRSArICdnZXRNZW1iZXJCeUdyb3VwJyArICc/dXNlcl9pZD0nICsgdGhpcy51c2VyX2lkLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBkYXRhOiBpZFxuICAgIH0pLnRoZW4oKHI6IGFueSkgPT4ge1xuICAgICAgcmV0dXJuIHIuZGF0YVxuICAgIH0pXG4gIH1cbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXBpRmFjYWRlKCk6IElBcGlGYWNhZGUge1xuICByZXR1cm4gbmV3IEFwaUZhY2FkZSgpO1xufSJdfQ==