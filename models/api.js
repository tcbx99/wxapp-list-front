"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var MockApiFacade = (function () {
    function MockApiFacade() {
        this.dummy_group_id = 1;
    }
    MockApiFacade.prototype.login = function () {
        return new Promise(function (r) { r({ token: "dummy", user_id: 1 }); });
    };
    MockApiFacade.prototype.createGroup = function (name, desc, gType) {
        var _this = this;
        return new Promise(function (r) {
            r({
                group_id: _this.dummy_group_id++,
                group_name: name,
                group_desc: desc,
                group_type: gType,
                missions_info: {
                    personal_finished_count: 0,
                    finished_count: 20,
                    all_count: 50
                },
                is_admin: true
            });
        });
    };
    MockApiFacade.prototype.updateGroup = function (list) {
        return new Promise(function (r) {
            r(list);
        });
    };
    MockApiFacade.prototype.deleteGroup = function () { return new Promise(function (r) { r(); }); };
    MockApiFacade.prototype.joinGroupFlow = function () {
        return new Promise(function (r) {
            r({ group_name: "测试", group_desc: "某某坤就是傻逼" });
        });
    };
    MockApiFacade.prototype.joinGroupConfirm = function (id) {
        return new Promise(function (r) {
            r({
                group_id: id,
                group_name: "测试",
                group_desc: "某某坤就是傻逼",
                group_type: 0,
                missions_info: {
                    personal_finished_count: 0,
                    finished_count: 20,
                    all_count: 50
                },
                is_admin: false
            });
        });
    };
    MockApiFacade.prototype.getGroups = function () {
        return new Promise(function (r) { r([]); });
    };
    return MockApiFacade;
}());
var APP_BASE = "http://localhost:8080/";
var ApiFacade = (function () {
    function ApiFacade() {
        this.token = '';
        this.user_id = 0;
        this.dummy_group_id = 1;
    }
    ApiFacade.prototype.promisify = function (f, p) {
        return new Promise(function (r, e) {
            p.success = function (d) { r(d); };
            p.fail = function (d) { e(d); };
            f(p);
        });
    };
    ApiFacade.prototype.login = function (code, u) {
        var _this = this;
        return this.promisify(wx.request, {
            url: APP_BASE + 'login',
            method: 'POST',
            data: {
                auth_code: code,
                nickname: u.nickName,
                avatar_url: u.avatarUrl,
            }
        }).then(function (r) {
            _this.token = r.data.token;
            _this.user_id = +r.data.user_id;
            return {
                token: r.data.token,
                user_id: r.data.user_id
            };
        });
    };
    ApiFacade.prototype.createGroup = function (name, desc, gType) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'createGroup' + '&user_id=' + this.user_id,
            method: 'POST',
            data: {
                group_name: name,
                group_desc: desc,
                group_type: gType,
            }
        }).then(function (r) {
            return r.data;
        });
    };
    ApiFacade.prototype.updateGroup = function (list) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'createGroup' + '&user_id=' + this.user_id,
            method: 'POST',
            data: {
                group_name: list.group_name,
                group_desc: list.group_desc,
                group_type: list.group_type,
            }
        }).then(function (r) {
            return r.data;
        });
    };
    ApiFacade.prototype.deleteGroup = function () { return new Promise(function (r) { r(); }); };
    ApiFacade.prototype.joinGroupFlow = function (id) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'joinGroupFlow' + '&user_id=' + this.user_id,
            method: 'POST',
            data: {
                group_id: id
            }
        }).then(function (r) {
            return r.data;
        });
    };
    ApiFacade.prototype.joinGroupConfirm = function (id) {
        return this.promisify(wx.request, {
            url: APP_BASE + 'joinGroupConfirm' + '&user_id=' + this.user_id,
            method: 'POST',
            data: {
                group_id: id
            }
        }).then(function (r) {
            return r.data;
        });
    };
    ApiFacade.prototype.getGroups = function () {
        return this.promisify(wx.request, {
            url: APP_BASE + 'getGroups' + '&user_id=' + this.user_id,
            method: 'GET',
        }).then(function (r) {
            return r.data;
        });
    };
    return ApiFacade;
}());
var ApiEnvironment;
(function (ApiEnvironment) {
    ApiEnvironment[ApiEnvironment["DEBUG"] = 0] = "DEBUG";
    ApiEnvironment[ApiEnvironment["PROD"] = 1] = "PROD";
})(ApiEnvironment = exports.ApiEnvironment || (exports.ApiEnvironment = {}));
function getApiFacade(env) {
    return env == ApiEnvironment.DEBUG ? new MockApiFacade() : new ApiFacade();
}
exports.getApiFacade = getApiFacade;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBpLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBaUJBO0lBQUE7UUFDRSxtQkFBYyxHQUFXLENBQUMsQ0FBQTtJQWtENUIsQ0FBQztJQWpEQyw2QkFBSyxHQUFMO1FBQ0UsT0FBTyxJQUFJLE9BQU8sQ0FBZ0IsVUFBQyxDQUFDLElBQU8sQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ2pGLENBQUM7SUFDRCxtQ0FBVyxHQUFYLFVBQVksSUFBWSxFQUFFLElBQVksRUFBRSxLQUFhO1FBQXJELGlCQWVDO1FBZEMsT0FBTyxJQUFJLE9BQU8sQ0FBUSxVQUFDLENBQUM7WUFDMUIsQ0FBQyxDQUFDO2dCQUNBLFFBQVEsRUFBRSxLQUFJLENBQUMsY0FBYyxFQUFFO2dCQUMvQixVQUFVLEVBQUUsSUFBSTtnQkFDaEIsVUFBVSxFQUFFLElBQUk7Z0JBQ2hCLFVBQVUsRUFBRSxLQUFLO2dCQUNqQixhQUFhLEVBQUU7b0JBQ2IsdUJBQXVCLEVBQUUsQ0FBQztvQkFDMUIsY0FBYyxFQUFFLEVBQUU7b0JBQ2xCLFNBQVMsRUFBRSxFQUFFO2lCQUNkO2dCQUNELFFBQVEsRUFBRSxJQUFJO2FBQ2YsQ0FBQyxDQUFBO1FBQ0osQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBQ0QsbUNBQVcsR0FBWCxVQUFZLElBQVc7UUFDckIsT0FBTyxJQUFJLE9BQU8sQ0FBUSxVQUFDLENBQUM7WUFDMUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQ1QsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0lBQ0QsbUNBQVcsR0FBWCxjQUErQixPQUFPLElBQUksT0FBTyxDQUFPLFVBQUMsQ0FBQyxJQUFPLENBQUMsRUFBRSxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ3pFLHFDQUFhLEdB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IH0gZnJvbSAnLi4vdXRpbHMvdHlwZXMnXG5cbmV4cG9ydCBpbnRlcmZhY2UgSUFwaUZhY2FkZSB7XG4gIGxvZ2luKGNvZGU6IHN0cmluZywgdTogd3guVXNlckluZm8pOiBQcm9taXNlPExvZ2luUmVzcG9uc2U+XG4gIGNyZWF0ZUdyb3VwKG5hbWU6IHN0cmluZywgZGVzYzogc3RyaW5nLCBnVHlwZTogbnVtYmVyKTogUHJvbWlzZTxJTGlzdD5cbiAgdXBkYXRlR3JvdXAobGlzdDogSUxpc3QpOiBQcm9taXNlPElMaXN0PlxuICBkZWxldGVHcm91cChsaXN0OiBJTGlzdCk6IFByb21pc2U8dm9pZD5cbiAgam9pbkdyb3VwRmxvdyhpZDogbnVtYmVyKTogUHJvbWlzZTx7IGdyb3VwX25hbWU6IHN0cmluZywgZ3JvdXBfZGVzYzogc3RyaW5nIH0+XG4gIGpvaW5Hcm91cENvbmZpcm0oaWQ6IG51bWJlcik6IFByb21pc2U8SUxpc3Q+XG4gIGdldEdyb3VwcygpOiBQcm9taXNlPEFycmF5PElMaXN0Pj5cbn1cblxuaW50ZXJmYWNlIExvZ2luUmVzcG9uc2Uge1xuICB0b2tlbjogc3RyaW5nLFxuICB1c2VyX2lkOiBudW1iZXJcbn1cblxuY2xhc3MgTW9ja0FwaUZhY2FkZSBpbXBsZW1lbnRzIElBcGlGYWNhZGUge1xuICBkdW1teV9ncm91cF9pZDogbnVtYmVyID0gMVxuICBsb2dpbigpOiBQcm9taXNlPExvZ2luUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8TG9naW5SZXNwb25zZT4oKHIpID0+IHsgcih7IHRva2VuOiBcImR1bW15XCIsIHVzZXJfaWQ6IDEgfSkgfSlcbiAgfVxuICBjcmVhdGVHcm91cChuYW1lOiBzdHJpbmcsIGRlc2M6IHN0cmluZywgZ1R5cGU6IG51bWJlcik6IFByb21pc2U8SUxpc3Q+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8SUxpc3Q+KChyKSA9PiB7XG4gICAgICByKHtcbiAgICAgICAgZ3JvdXBfaWQ6IHRoaXMuZHVtbXlfZ3JvdXBfaWQrKyxcbiAgICAgICAgZ3JvdXBfbmFtZTogbmFtZSxcbiAgICAgICAgZ3JvdXBfZGVzYzogZGVzYyxcbiAgICAgICAgZ3JvdXBfdHlwZTogZ1R5cGUsXG4gICAgICAgIG1pc3Npb25zX2luZm86IHtcbiAgICAgICAgICBwZXJzb25hbF9maW5pc2hlZF9jb3VudDogMCxcbiAgICAgICAgICBmaW5pc2hlZF9jb3VudDogMjAsXG4gICAgICAgICAgYWxsX2NvdW50OiA1MFxuICAgICAgICB9LFxuICAgICAgICBpc19hZG1pbjogdHJ1ZVxuICAgICAgfSlcbiAgICB9KVxuICB9XG4gIHVwZGF0ZUdyb3VwKGxpc3Q6IElMaXN0KTogUHJvbWlzZTxJTGlzdD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxJTGlzdD4oKHIpID0+IHtcbiAgICAgIHIobGlzdClcbiAgICB9KVxuICB9XG4gIGRlbGV0ZUdyb3VwKCk6IFByb21pc2U8dm9pZD4geyByZXR1cm4gbmV3IFByb21pc2U8dm9pZD4oKHIpID0+IHsgcigpIH0pIH1cbiAgam9pbkdyb3VwRmxvdygpOiBQcm9taXNlPHsgZ3JvdXBfbmFtZTogc3RyaW5nLCBncm91cF9kZXNjOiBzdHJpbmcgfT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocikgPT4ge1xuICAgICAgcih7IGdyb3VwX25hbWU6IFwi5rWL6K+VXCIsIGdyb3VwX2Rlc2M6IFwi5p+Q5p+Q5Z2k5bCx5piv5YK76YC8XCIgfSlcbiAgICB9KVxuICB9XG4gIGpvaW5Hcm91cENvbmZpcm0oaWQ6IG51bWJlcik6IFByb21pc2U8SUxpc3Q+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHIpID0+IHtcbiAgICAgIHIoe1xuICAgICAgICBncm91cF9pZDogaWQsXG4gICAgICAgIGdyb3VwX25hbWU6IFwi5rWL6K+VXCIsXG4gICAgICAgIGdyb3VwX2Rlc2M6IFwi5p+Q5p+Q5Z2k5bCx5piv5YK76YC8XCIsXG4gICAgICAgIGdyb3VwX3R5cGU6IDAsXG4gICAgICAgIG1pc3Npb25zX2luZm86IHtcbiAgICAgICAgICBwZXJzb25hbF9maW5pc2hlZF9jb3VudDogMCxcbiAgICAgICAgICBmaW5pc2hlZF9jb3VudDogMjAsXG4gICAgICAgICAgYWxsX2NvdW50OiA1MFxuICAgICAgICB9LFxuICAgICAgICBpc19hZG1pbjogZmFsc2VcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuICBnZXRHcm91cHMoKTogUHJvbWlzZTxBcnJheTxJTGlzdD4+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHIpID0+IHsgcihbXSkgfSk7XG4gIH1cbn1cblxuY29uc3QgQVBQX0JBU0UgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9cIlxuXG5jbGFzcyBBcGlGYWNhZGUgaW1wbGVtZW50cyBJQXBpRmFjYWRlIHtcbiAgdG9rZW4gPSAnJ1xuICB1c2VyX2lkID0gMFxuICBkdW1teV9ncm91cF9pZDogbnVtYmVyID0gMVxuXG4gIHByaXZhdGUgcHJvbWlzaWZ5KGY6IChvOiBhbnkpID0+IGFueSwgcDogYW55KTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHIsIGUpID0+IHtcbiAgICAgIHAuc3VjY2VzcyA9IChkOiBhbnkpID0+IHsgcihkKSB9XG4gICAgICBwLmZhaWwgPSAoZDogYW55KSA9PiB7IGUoZCkgfVxuICAgICAgZihwKVxuICAgIH0pXG4gIH1cblxuICBsb2dpbihjb2RlOiBzdHJpbmcsIHU6IHd4LlVzZXJJbmZvKTogUHJvbWlzZTxMb2dpblJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHRoaXMucHJvbWlzaWZ5KHd4LnJlcXVlc3QsIHtcbiAgICAgIHVybDogQVBQX0JBU0UgKyAnbG9naW4nLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGF1dGhfY29kZTogY29kZSxcbiAgICAgICAgbmlja25hbWU6IHUubmlja05hbWUsXG4gICAgICAgIGF2YXRhcl91cmw6IHUuYXZhdGFyVXJsLFxuICAgICAgfVxuICAgIH0pLnRoZW4oKHI6IGFueSkgPT4ge1xuICAgICAgdGhpcy50b2tlbiA9IHIuZGF0YS50b2tlblxuICAgICAgdGhpcy51c2VyX2lkID0gK3IuZGF0YS51c2VyX2lkXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b2tlbjogci5kYXRhLnRva2VuLFxuICAgICAgICB1c2VyX2lkOiByLmRhdGEudXNlcl9pZFxuICAgICAgfVxuICAgIH0pXG4gIH1cbiAgY3JlYXRlR3JvdXAobmFtZTogc3RyaW5nLCBkZXNjOiBzdHJpbmcsIGdUeXBlOiBudW1iZXIpOiBQcm9taXNlPElMaXN0PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvbWlzaWZ5KHd4LnJlcXVlc3QsIHtcbiAgICAgIHVybDogQVBQX0JBU0UgKyAnY3JlYXRlR3JvdXAnICsgJyZ1c2VyX2lkPScgKyB0aGlzLnVzZXJfaWQsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgZ3JvdXBfbmFtZTogbmFtZSxcbiAgICAgICAgZ3JvdXBfZGVzYzogZGVzYyxcbiAgICAgICAgZ3JvdXBfdHlwZTogZ1R5cGUsXG4gICAgICB9XG4gICAgfSkudGhlbigocjogYW55KSA9PiB7XG4gICAgICByZXR1cm4gPElMaXN0Pjxhbnk+ci5kYXRhO1xuICAgIH0pXG4gIH1cbiAgdXBkYXRlR3JvdXAobGlzdDogSUxpc3QpOiBQcm9taXNlPElMaXN0PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvbWlzaWZ5KHd4LnJlcXVlc3QsIHtcbiAgICAgIHVybDogQVBQX0JBU0UgKyAnY3JlYXRlR3JvdXAnICsgJyZ1c2VyX2lkPScgKyB0aGlzLnVzZXJfaWQsXG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgZ3JvdXBfbmFtZTogbGlzdC5ncm91cF9uYW1lLFxuICAgICAgICBncm91cF9kZXNjOiBsaXN0Lmdyb3VwX2Rlc2MsXG4gICAgICAgIGdyb3VwX3R5cGU6IGxpc3QuZ3JvdXBfdHlwZSxcbiAgICAgIH1cbiAgICB9KS50aGVuKChyOiBhbnkpID0+IHtcbiAgICAgIHJldHVybiA8SUxpc3Q+PGFueT5yLmRhdGE7XG4gICAgfSlcbiAgfVxuICBkZWxldGVHcm91cCgpOiBQcm9taXNlPHZvaWQ+IHsgcmV0dXJuIG5ldyBQcm9taXNlPHZvaWQ+KChyKSA9PiB7IHIoKSB9KSB9XG4gIGpvaW5Hcm91cEZsb3coaWQ6IG51bWJlcik6IFByb21pc2U8eyBncm91cF9uYW1lOiBzdHJpbmcsIGdyb3VwX2Rlc2M6IHN0cmluZyB9PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvbWlzaWZ5KHd4LnJlcXVlc3QsIHtcbiAgICAgIHVybDogQVBQX0JBU0UgKyAnam9pbkdyb3VwRmxvdycgKyAnJnVzZXJfaWQ9JyArIHRoaXMudXNlcl9pZCxcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgZGF0YToge1xuICAgICAgICBncm91cF9pZDogaWRcbiAgICAgIH1cbiAgICB9KS50aGVuKChyOiBhbnkpID0+IHtcbiAgICAgIHJldHVybiA8YW55PnIuZGF0YTtcbiAgICB9KVxuICB9XG4gIGpvaW5Hcm91cENvbmZpcm0oaWQ6IG51bWJlcik6IFByb21pc2U8SUxpc3Q+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9taXNpZnkod3gucmVxdWVzdCwge1xuICAgICAgdXJsOiBBUFBfQkFTRSArICdqb2luR3JvdXBDb25maXJtJyArICcmdXNlcl9pZD0nICsgdGhpcy51c2VyX2lkLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGdyb3VwX2lkOiBpZFxuICAgICAgfVxuICAgIH0pLnRoZW4oKHI6IGFueSkgPT4ge1xuICAgICAgcmV0dXJuIDxhbnk+ci5kYXRhO1xuICAgIH0pXG4gIH1cbiAgZ2V0R3JvdXBzKCk6IFByb21pc2U8QXJyYXk8SUxpc3Q+PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvbWlzaWZ5KHd4LnJlcXVlc3QsIHtcbiAgICAgIHVybDogQVBQX0JBU0UgKyAnZ2V0R3JvdXBzJyArICcmdXNlcl9pZD0nICsgdGhpcy51c2VyX2lkLFxuICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICB9KS50aGVuKChyOiBhbnkpID0+IHtcbiAgICAgIHJldHVybiA8YW55PnIuZGF0YTtcbiAgICB9KVxuICB9XG59XG5cbmV4cG9ydCBlbnVtIEFwaUVudmlyb25tZW50IHsgREVCVUcsIFBST0QgfVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXBpRmFjYWRlKGVudjogQXBpRW52aXJvbm1lbnQpOiBJQXBpRmFjYWRlIHtcbiAgcmV0dXJuIGVudiA9PSBBcGlFbnZpcm9ubWVudC5ERUJVRyA/IG5ldyBNb2NrQXBpRmFjYWRlKCkgOiBuZXcgQXBpRmFjYWRlKCk7XG59Il19